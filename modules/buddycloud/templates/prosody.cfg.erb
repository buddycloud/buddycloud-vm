modules_enabled = {
  "roster";             -- Allow users to have a roster.
  "saslauth";           -- Authentication for clients and servers. Recommended if you want to log in.
  "tls";                -- Add support for secure TLS on c2s/s2s connections
  "dialback";           -- s2s dialback support
  "disco";              -- Service discovery
  "time";               -- Let others know the time here on this server
  "ping";               -- Replies to XMPP pings with pongs
  "posix";              -- Do posixy things
  "register";           -- Allow users to register on this server using a client and change passwords
  "bosh";               -- Enable BOSH clients, aka "Jabber over HTTP"
  "watchregistrations"; -- Alert admins of registrations
  "compression";        -- Enable mod_compression
  "legacyauth";         -- Needed by strophe
};
 
storage                 = "sql"
sql                     = { driver = "PostgreSQL"; database = "buddycloud-prosody"; username = "buddycloud"; password = "<%= serversecret %>"; host = "localhost" }
admins                  = { <%= iadmin.map{|x| "\"" + x + "\""}.join(";") %> }
pidfile                 = "/var/run/prosody/prosody.pid"
bosh_ports              = {{ interface = "127.0.0.1" }} -- enable bosh connections from a webserver that can reach 127.0.0.1
log                     = { error = "/var/log/prosody/prosody.err"; debug = "/var/log/prosody/prosody.log" } -- Change 'info' to 'debug' for more verbose logging
consider_bosh_secure    = true
 
 
VirtualHost "<%= domain %>"
  authentication        = "internal_hashed"
  allow_registration    = true -- if you want this, replace mod_register.lua with http://hg.prosody.im/0.9/raw-file/5e84fb3c4ba0/plugins/mod_register.lua
  anonymous_login       = false
  ssl                   = { key = "/etc/prosody/certs/example.com.key"; certificate = "/etc/prosody/certs/example.com.crt" }
 
-- when an unauthenticated browser connects via BOSH, it binds as an anonymous (ephemeral) userID.
-- this domain is where we place these short lived browsing users. They cannot do anything other than
-- communicate in this domain (no server to server communication)
VirtualHost "anon.<%= domain %>"
  authentication        = "anonymous"
  allow_registration    = false
  anonymous_login       = true
  disallow_s2s          = true
 
Component "buddycloud.<%= domain %>"
  component_secret      = "<%= serversecret %>"
