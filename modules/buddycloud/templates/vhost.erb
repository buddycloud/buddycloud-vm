<VirtualHost *:80>
        # push any non-secure requests to HTTPS
        ServerName  <%= domain %>
        RewriteEngine On
        RewriteCond %{HTTPS} off
        RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI}
</VirtualHost>
 
<VirtualHost *:443>
        ServerName  example.com
        SSLEngine On
        SSLCertificateFile      /etc/apache2/<%= domain %>.cert
        SSLCertificateKeyFile   /etc/apache2/<%= domain %>.key
        # if you used StartSSL.com for the cert, install this file:  https://www.startssl.com/certs/sub.class1.server.ca.crt below
        # SSLCertificateChainFile /etc/apache2/certs/sub.class1.server.ca.crt
        DocumentRoot /srv/http
        LogLevel alert
        ErrorLog  /var/log/apache2/<%= domain %>-error.log
        CustomLog /var/log/apache2/<%= domain %>-access.log combined
        # the BOSH connection is reverse proxied to the prosody server which listens on port 5280
        <Proxy *>
                Order deny,allow
                Allow from all
        </Proxy>
        # note the trailing "/". This is important.
        RewriteRule ^/http-bind/$ http://localhost:5280/http-bind/ [P,L]
        # all requests other than /web, /public and *.html are redirected to index.html
        RewriteEngine On
        RewriteCond %{REQUEST_URI} !^/http-bind/$
        RewriteCond %{REQUEST_URI} !^/web/
        RewriteCond %{REQUEST_URI} !^/public/
        RewriteCond %{REQUEST_URI} !^/config\.js$
        RewriteCond %{REQUEST_URI} !^(.*)\.html$
        RewriteRule ^(.*)$ /index.html
</VirtualHost>

